basePath: /api/v1
definitions:
  handler.CreateReq:
    properties:
      color:
        type: string
      name:
        maxLength: 128
        minLength: 1
        type: string
    required:
    - name
    type: object
  handler.CreateTaskRequest:
    properties:
      content_md:
        type: string
      due_at:
        type: string
      priority:
        type: integer
      project_id:
        type: integer
      status:
        type: string
      title:
        maxLength: 200
        type: string
    required:
    - project_id
    - title
    type: object
  handler.ErrorResponse:
    properties:
      code:
        type: integer
      msg:
        type: string
    type: object
  handler.LoginData:
    properties:
      access_expires_at:
        type: string
      access_token:
        type: string
      token_type:
        type: string
    type: object
  handler.LoginReq:
    properties:
      password:
        maxLength: 72
        minLength: 8
        type: string
      username:
        maxLength: 64
        minLength: 2
        type: string
    required:
    - password
    - username
    type: object
  handler.LoginResponse:
    properties:
      code:
        type: integer
      count:
        type: integer
      data:
        $ref: '#/definitions/handler.LoginData'
      msg:
        type: string
    type: object
  handler.LogoutResponse:
    properties:
      code:
        type: integer
      count:
        type: integer
      data: {}
      msg:
        type: string
    type: object
  handler.ProjectCreateData:
    properties:
      project:
        $ref: '#/definitions/models.Project'
    type: object
  handler.ProjectCreateResponse:
    properties:
      code:
        type: integer
      count:
        type: integer
      data:
        $ref: '#/definitions/handler.ProjectCreateData'
      msg:
        type: string
    type: object
  handler.ProjectDeleteData:
    properties:
      id:
        type: integer
      proj_affected:
        type: integer
      task_affected:
        type: integer
    type: object
  handler.ProjectDeleteResponse:
    properties:
      code:
        type: integer
      count:
        type: integer
      data:
        $ref: '#/definitions/handler.ProjectDeleteData'
      msg:
        type: string
    type: object
  handler.ProjectDetailData:
    properties:
      project:
        $ref: '#/definitions/service.ProjectProfile'
    type: object
  handler.ProjectDetailResponse:
    properties:
      code:
        type: integer
      count:
        type: integer
      data:
        $ref: '#/definitions/handler.ProjectDetailData'
      msg:
        type: string
    type: object
  handler.ProjectListData:
    properties:
      list:
        items:
          $ref: '#/definitions/service.ProjectSummary'
        type: array
      page:
        type: integer
      page_size:
        type: integer
      total:
        type: integer
    type: object
  handler.ProjectListResponse:
    properties:
      code:
        type: integer
      count:
        type: integer
      data:
        $ref: '#/definitions/handler.ProjectListData'
      msg:
        type: string
    type: object
  handler.ProjectUpdateData:
    properties:
      project:
        $ref: '#/definitions/models.Project'
    type: object
  handler.ProjectUpdateResponse:
    properties:
      code:
        type: integer
      count:
        type: integer
      data:
        $ref: '#/definitions/handler.ProjectUpdateData'
      msg:
        type: string
    type: object
  handler.RegisterResponse:
    properties:
      code:
        type: integer
      count:
        type: integer
      data:
        $ref: '#/definitions/models.User'
      msg:
        type: string
    type: object
  handler.TaskCreateData:
    properties:
      task:
        $ref: '#/definitions/models.Task'
    type: object
  handler.TaskCreateResponse:
    properties:
      code:
        type: integer
      count:
        type: integer
      data:
        $ref: '#/definitions/handler.TaskCreateData'
      msg:
        type: string
    type: object
  handler.TaskDeleteData:
    properties:
      id:
        type: integer
      task_affected:
        type: integer
    type: object
  handler.TaskDeleteResponse:
    properties:
      code:
        type: integer
      count:
        type: integer
      data:
        $ref: '#/definitions/handler.TaskDeleteData'
      msg:
        type: string
    type: object
  handler.TaskDetailResponse:
    properties:
      code:
        type: integer
      count:
        type: integer
      data:
        $ref: '#/definitions/service.TaskDetail'
      msg:
        type: string
    type: object
  handler.TaskListData:
    properties:
      list:
        items:
          $ref: '#/definitions/service.TaskSummary'
        type: array
      page:
        type: integer
      page_size:
        type: integer
      total:
        type: integer
    type: object
  handler.TaskListResponse:
    properties:
      code:
        type: integer
      count:
        type: integer
      data:
        $ref: '#/definitions/handler.TaskListData'
      msg:
        type: string
    type: object
  handler.TaskUpdateResponse:
    properties:
      code:
        type: integer
      count:
        type: integer
      data:
        $ref: '#/definitions/models.Task'
      msg:
        type: string
    type: object
  handler.UpdateReq:
    properties:
      color:
        maxLength: 16
        type: string
      name:
        maxLength: 128
        minLength: 1
        type: string
      sort_order:
        type: integer
    type: object
  handler.UpdateTaskRequest:
    properties:
      content_md:
        type: string
      priority:
        maximum: 5
        minimum: 1
        type: integer
      re_due_at:
        type: string
      re_project_id:
        type: integer
      sort_order:
        minimum: 0
        type: integer
      status:
        enum:
        - todo
        - done
        type: string
      title:
        maxLength: 200
        type: string
    type: object
  handler.UpdateUserResponse:
    properties:
      code:
        type: integer
      count:
        type: integer
      data: {}
      msg:
        type: string
    type: object
  models.Project:
    properties:
      color:
        type: string
      created_at:
        type: string
      id:
        type: integer
      name:
        type: string
      sort_order:
        type: integer
      updated_at:
        type: string
      user_id:
        type: integer
    type: object
  models.Task:
    properties:
      content_html:
        type: string
      content_md:
        type: string
      created_at:
        type: string
      due_at:
        type: string
      id:
        type: integer
      notified:
        type: boolean
      priority:
        type: integer
      project_id:
        type: integer
      sort_order:
        type: integer
      status:
        type: string
      title:
        type: string
      updated_at:
        type: string
      user_id:
        type: integer
    type: object
  models.User:
    properties:
      avatar_url:
        type: string
      created_at:
        type: string
      email:
        type: string
      id:
        type: integer
      timezone:
        type: string
      updated_at:
        type: string
      username:
        type: string
    type: object
  service.ProjectProfile:
    properties:
      color:
        type: string
      created_at:
        type: string
      id:
        type: integer
      name:
        type: string
      sort_order:
        type: integer
      updated_at:
        type: string
      user_id:
        type: integer
    type: object
  service.ProjectSummary:
    properties:
      color:
        type: string
      id:
        type: integer
      name:
        type: string
      updated_at:
        type: string
    type: object
  service.TaskDetail:
    properties:
      content_html:
        type: string
      due_at:
        type: string
      id:
        type: integer
      project_id:
        type: integer
      status:
        type: string
      title:
        type: string
      user_id:
        type: integer
    type: object
  service.TaskSummary:
    properties:
      due_at:
        type: string
      id:
        type: integer
      status:
        type: string
      title:
        type: string
    type: object
info:
  contact: {}
  description: 管理API
  title: ToDoList API
  version: "1.0"
paths:
  /login:
    post:
      consumes:
      - application/json
      description: 使用用户名和密码进行身份验证，获取JWT token
      parameters:
      - description: 登录请求参数
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/handler.LoginReq'
      produces:
      - application/json
      responses:
        "200":
          description: 登录成功，返回token
          schema:
            $ref: '#/definitions/handler.LoginResponse'
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "401":
          description: 登录失败
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "404":
          description: 用户不存在
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "500":
          description: 系统错误
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      summary: 用户登录
  /logout:
    post:
      description: 需要有效的JWT token认证，无需请求体
      produces:
      - application/json
      responses:
        "200":
          description: 退出登录成功
          schema:
            $ref: '#/definitions/handler.LogoutResponse'
        "401":
          description: 未授权或token无效
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "500":
          description: 写入Redis出错
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      security:
      - Bearer: []
      summary: 用户登出
  /projects:
    get:
      consumes:
      - application/json
      description: 获取当前用户的项目列表，支持按名称模糊搜索和分页
      parameters:
      - description: 项目名称关键字（模糊搜索）
        in: query
        name: name
        type: string
      - description: 页码（默认1）
        in: query
        name: page
        type: integer
      - description: 每页数量（默认20，最大100）
        in: query
        name: page_size
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功，返回项目列表
          schema:
            $ref: '#/definitions/handler.ProjectListResponse'
        "401":
          description: 未授权或token无效
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "500":
          description: 系统错误
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      security:
      - Bearer: []
      summary: 搜索项目列表
    post:
      consumes:
      - application/json
      description: 创建新项目，项目名称必需且不能为空
      parameters:
      - description: 项目创建请求体
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/handler.CreateReq'
      produces:
      - application/json
      responses:
        "200":
          description: 创建成功，返回项目信息
          schema:
            $ref: '#/definitions/handler.ProjectCreateResponse'
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "401":
          description: 未授权或token无效
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "409":
          description: 项目重复
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "500":
          description: 系统错误
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      security:
      - Bearer: []
      summary: 创建项目
  /projects/{id}:
    delete:
      consumes:
      - application/json
      description: 删除项目及其关联的所有任务
      parameters:
      - description: 项目ID
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: 删除成功，返回删除的项目ID和受影响的行数
          schema:
            $ref: '#/definitions/handler.ProjectDeleteResponse'
        "400":
          description: 非法的项目ID
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "401":
          description: 未授权或token无效
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "404":
          description: 项目不存在
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "500":
          description: 系统错误
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      security:
      - Bearer: []
      summary: 删除项目
    get:
      consumes:
      - application/json
      description: 根据项目ID获取项目的详细信息，包括名称、颜色和创建时间
      parameters:
      - description: 项目ID
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功，返回项目信息
          schema:
            $ref: '#/definitions/handler.ProjectDetailResponse'
        "400":
          description: 非法的项目ID
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "401":
          description: 未授权或token无效
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "404":
          description: 项目不存在
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "500":
          description: 系统错误
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      security:
      - Bearer: []
      summary: 获取项目详情
    patch:
      consumes:
      - application/json
      description: 更新项目的名称、颜色和排序顺序（可选项）
      parameters:
      - description: 项目ID
        in: path
        name: id
        required: true
        type: integer
      - description: 项目更新请求体
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/handler.UpdateReq'
      produces:
      - application/json
      responses:
        "200":
          description: 更新成功，返回更新后的项目信息
          schema:
            $ref: '#/definitions/handler.ProjectUpdateResponse'
        "400":
          description: 非法的项目ID或参数格式错误
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "401":
          description: 未授权或token无效
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "404":
          description: 项目不存在
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "409":
          description: 项目重复
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "500":
          description: 系统错误
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      security:
      - Bearer: []
      summary: 更新项目信息
  /projects/{id}/tasks/{task_id}:
    get:
      consumes:
      - application/json
      description: 根据项目ID和任务ID获取任务详情
      parameters:
      - description: 项目ID
        in: path
        name: id
        required: true
        type: integer
      - description: 任务ID
        in: path
        name: task_id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功，返回任务详情
          schema:
            $ref: '#/definitions/handler.TaskDetailResponse'
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "401":
          description: 未授权或token无效
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "404":
          description: 任务不存在或项目不存在
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "500":
          description: 系统错误
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      security:
      - Bearer: []
      summary: 获取任务详情
    patch:
      consumes:
      - application/json
      description: 更新任务的名称、内容、状态、优先级、项目和截止时间
      parameters:
      - description: 项目ID
        in: path
        name: id
        required: true
        type: integer
      - description: 任务ID
        in: path
        name: task_id
        required: true
        type: integer
      - description: 任务更新请求体
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/handler.UpdateTaskRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 更新成功，返回任务信息
          schema:
            $ref: '#/definitions/handler.TaskUpdateResponse'
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "401":
          description: 未授权或token无效
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "404":
          description: 任务不存在或项目不存在
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "409":
          description: 任务已存在
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "500":
          description: 系统错误
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      security:
      - Bearer: []
      summary: 更新任务
  /register:
    post:
      consumes:
      - multipart/form-data
      description: 使用邮箱、用户名、密码和头像进行注册
      parameters:
      - description: 邮箱地址
        in: formData
        name: email
        required: true
        type: string
      - description: 用户名（2-64字符）
        in: formData
        name: username
        required: true
        type: string
      - description: 密码（8-72字符）
        in: formData
        name: password
        required: true
        type: string
      - description: 确认密码
        in: formData
        name: confirm_password
        required: true
        type: string
      - description: 头像文件
        in: formData
        name: file
        required: true
        type: file
      produces:
      - application/json
      responses:
        "200":
          description: 注册成功，返回用户信息
          schema:
            $ref: '#/definitions/handler.RegisterResponse'
        "400":
          description: 参数错误或头像上传失败
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "409":
          description: 用户已存在
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "500":
          description: 系统错误
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      summary: 用户注册
  /tasks:
    get:
      consumes:
      - application/json
      description: 获取指定项目下的任务列表，支持状态筛选和分页
      parameters:
      - description: 项目ID
        in: query
        name: project_id
        required: true
        type: integer
      - description: 任务状态（todo/done）
        in: query
        name: status
        type: string
      - description: 页码（默认1）
        in: query
        name: page
        type: integer
      - description: 每页数量（默认20，最大100）
        in: query
        name: page_size
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功，返回任务列表
          schema:
            $ref: '#/definitions/handler.TaskListResponse'
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "401":
          description: 未授权或token无效
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "404":
          description: 项目不存在
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "500":
          description: 系统错误
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      security:
      - Bearer: []
      summary: 获取任务列表
    post:
      consumes:
      - application/json
      description: 在指定项目下创建新任务
      parameters:
      - description: 任务创建请求体
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/handler.CreateTaskRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 创建成功，返回任务信息
          schema:
            $ref: '#/definitions/handler.TaskCreateResponse'
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "401":
          description: 未授权或token无效
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "404":
          description: 项目不存在
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "409":
          description: 任务已存在
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "500":
          description: 系统错误
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      security:
      - Bearer: []
      summary: 创建任务
  /tasks/{id}:
    delete:
      consumes:
      - application/json
      description: 删除指定项目下的任务
      parameters:
      - description: 任务ID
        in: path
        name: id
        required: true
        type: integer
      - description: 项目ID
        in: query
        name: project_id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: 删除成功，返回任务ID和受影响的行数
          schema:
            $ref: '#/definitions/handler.TaskDeleteResponse'
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "401":
          description: 未授权或token无效
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "404":
          description: 任务不存在或项目不存在
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "500":
          description: 系统错误
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      security:
      - Bearer: []
      summary: 删除任务
  /users/me:
    patch:
      consumes:
      - multipart/form-data
      description: 更新用户邮箱、用户名、密码和头像（头像可选）
      parameters:
      - description: 邮箱地址
        in: formData
        name: email
        type: string
      - description: 用户名（2-64字符）
        in: formData
        name: username
        type: string
      - description: 新密码（8-72字符）
        in: formData
        name: password
        type: string
      - description: 确认新密码
        in: formData
        name: confirm_password
        type: string
      - description: 头像文件（可选）
        in: formData
        name: file
        type: file
      produces:
      - application/json
      responses:
        "200":
          description: 更新成功,如更新密码则刷新token
          schema:
            $ref: '#/definitions/handler.UpdateUserResponse'
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "401":
          description: 未授权
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "409":
          description: 用户名或邮箱已存在
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
        "500":
          description: 系统错误
          schema:
            $ref: '#/definitions/handler.ErrorResponse'
      security:
      - Bearer: []
      summary: 更新用户信息
securityDefinitions:
  Bearer:
    in: header
    name: Authorization
    type: apiKey
swagger: "2.0"
